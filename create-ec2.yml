---
- name: Provision EC2
  hosts: localhost
  connection: local
  module_defaults:
    group/aws:
      aws_access_key: '{{ aws_access_key }}'
      aws_secret_key: '{{ aws_secret_key }}'
      region: '{{ region }}'

  vars:
    key_name: mamendola
    region: us-east-1
    image: ami-06640050dc3f556bb
    id: web-app
    instance_type: t3.micro
    subnet: subnet-03d84a11ebe272d96

  tasks:

    - name: Provision an EC2 instance with a public IP address
      amazon.aws.ec2_instance:
        name: Demo
        key_name: "{{ key_name }}"
        vpc_subnet_id: "{{ subnet }}"
        instance_type: "{{ instance_type }}"
        security_group: default
        network:
          assign_public_ip: true
        image_id: "{{ image }}"
        tags:
          Environment: Testing
      register: result
